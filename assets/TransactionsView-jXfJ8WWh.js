import{n as $,i as T,_ as x,u as b,o as c,c as d,a as t,t as r,w as p,p as k,v as m,F as v,r as S,d as A,q as D,b as I}from"./index-DJzXngCq.js";import{_ as w}from"./users_table-C4Box7BH.js";import"./users_item-C_LfcF1q.js";import"./userService-CASxWzDT.js";const P=$("transactionStore",{state:()=>({accountInfo:null,transactionsList:[]}),getters:{getAccountInfo:o=>o.accountInfo,getTransactionsList:o=>o.transactionsList},actions:{async getTransactionOfCustomerByType(o,n=null,l=null,i=null,e=null,u=null,h=null,g=null,s=null,_=null){try{let a=`accountType=${o}`;(n=="TRANSFER"||n=="DEPOSIT"||n=="WITHDRAWAL")&&(a=`${a}&transactionType=${n}`),l!=null&&(a=`${a}&startDate=${l}`),i!=null&&(a=`${a}&endDate=${i}`),e!=null&&(a=`${a}&minAmount=${e}`),h!=null&&(a=`${a}&maxAmount=${h}`),u!=null&&(a=`${a}&exactAmount=${u}`),g!=null&&(a=`${a}&iban=${g}`),s!=null&&(a=`${a}&limit=${s}`),_!=null&&(a=`${a}&skip=${_}`);const y=await T.get(`/transactions?${a}`);return this.accountInfo=y.data.account,this.transactionsList=y.data.transactions,y.data}catch(a){throw a.response.data}},async createTransaction(o){try{const n={sender:o.sender,receiver:o.receiver,amount:o.amount,type:o.type};return(await T.post("/transactions",n)).data}catch(n){throw console.error(n.response.data),n.response.data}},async filterTransactions(o,n=null,l=null,i=null){try{let e=`condition=${o}`;n!=null&&(e=`${e}&userId=${n}`),i!=null&&(e=`${e}&limit=${i}`),l!=null&&(e=`${e}&skip=${l}`);const u=await T.get(`/transactions/history?${e}`);return this.transactionsList=u.data.transactions,u.data}catch(e){console.log(e)}}}}),f=o=>{const n=new Date(o),l=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),e=String(n.getDate()).padStart(2,"0"),u=String(n.getHours()).padStart(2,"0"),h=String(n.getMinutes()).padStart(2,"0");return`${l}-${i}-${e} ${u}:${h}`},C={name:"TransactionPage",props:["type"],data(){return{loginStore:b(),transactionStore:P(),name:"customer",account:null,transactions:[],currentPage:1,pageSize:10,skip:0,transactionType:null,startDate:null,endDate:null,minAmount:null,exactAmount:null,maxAmount:null,iban:null,errorMsg:""}},mounted(){this.name=this.loginStore.name,this.getAllTransactionsWithType()},watch:{type:"getAllTransactionsWithType"},methods:{formatDate:f,async getAllTransactionsWithType(){try{this.skip=(this.currentPage-1)*this.pageSize,this.limit=this.pageSize,await this.transactionStore.getTransactionOfCustomerByType(this.type,this.transactionType,this.startDate,this.endDate,this.minAmount,this.exactAmount,this.maxAmount,this.iban,this.limit,this.skip),this.account=this.transactionStore.getAccountInfo,this.transactions=this.transactionStore.getTransactionsList}catch{this.transactions=[]}},nextPage(){this.currentPage++,this.getAllTransactionsWithType()},prevPage(){this.currentPage>1&&(this.currentPage--,this.getAllTransactionsWithType())},async filterTransactions(){this.getAllTransactionsWithType()}}},L={class:"transaction_view"},M={class:"container mx-5 mt-5 mb-3",style:{color:"white"}},U={style:{"font-size":"30px"}},W=t("br",null,null,-1),F=t("br",null,null,-1),N={class:"mx-5",style:{"font-size":"35px"}},R={class:"me-5",style:{"font-size":"35px",float:"right"}},V=t("br",null,null,-1),z={class:"container mx-5 mt-5 mb-3"},E=t("td",null,[t("label",{for:"transaction-type"},"Transaction Type:")],-1),B=t("option",{value:"all"},"All",-1),O=t("option",{value:"TRANSFER"},"Transfer",-1),q=t("option",{value:"DEPOSIT"},"Deposit",-1),H=t("option",{value:"WITHDRAWAL"},"Withdrawal",-1),j=[B,O,q,H],Y=t("td",null,[t("label",{for:"start-date"},"Start Date:")],-1),G=t("td",null,[t("label",{for:"end-date"},"End Date:")],-1),J=t("td",null,[t("label",{for:"min-amount"},"Min amount:")],-1),K=t("td",null,[t("label",{for:"max-amount"},"Max amount:")],-1),Q=t("td",null,[t("label",{for:"exact-amount"},"Exact amount:")],-1),X=t("td",null,[t("label",{for:"iban"},"IBAN:")],-1),Z={colspan:"4",style:{"text-align":"center"}},tt={class:"container mx-5 mt-5 mb-3"},nt={class:"container",style:{color:"black"}},et=t("h1",{class:"m-3",style:{color:"#6504c6"}},"Transactions",-1),st={class:"table table-bordered mx-5"},ot=t("thead",null,[t("tr",null,[t("th",null,"Transaction Type"),t("th",null,"Sender"),t("th",null,"Receiver"),t("th",null,"Date"),t("th",null,"Amount (€)")])],-1),lt={class:"pagination-controls"},it=["disabled"],at={class:"text-danger errorMsg"};function rt(o,n,l,i,e,u){var h,g;return c(),d("div",L,[t("div",M,[t("span",U," Showing "+r(l.type)+" account of "+r(e.name),1),W,F,t("span",N,"IBAN → "+r((h=e.account)==null?void 0:h.iban),1),t("span",R,"€ "+r((g=e.account)==null?void 0:g.balance),1),V]),t("div",z,[t("table",null,[t("tr",null,[E,t("td",null,[p(t("select",{id:"transaction-type","onUpdate:modelValue":n[0]||(n[0]=s=>e.transactionType=s)},j,512),[[k,e.transactionType]])])]),t("tr",null,[Y,t("td",null,[p(t("input",{id:"start-date","onUpdate:modelValue":n[1]||(n[1]=s=>e.startDate=s),type:"date"},null,512),[[m,e.startDate]])]),G,t("td",null,[p(t("input",{id:"end-date","onUpdate:modelValue":n[2]||(n[2]=s=>e.endDate=s),type:"date"},null,512),[[m,e.endDate]])])]),t("tr",null,[J,t("td",null,[p(t("input",{id:"min-amount","onUpdate:modelValue":n[3]||(n[3]=s=>e.minAmount=s),type:"number"},null,512),[[m,e.minAmount]])]),K,t("td",null,[p(t("input",{id:"max-amount","onUpdate:modelValue":n[4]||(n[4]=s=>e.maxAmount=s),type:"number"},null,512),[[m,e.maxAmount]])])]),t("tr",null,[Q,t("td",null,[p(t("input",{id:"exact-amount","onUpdate:modelValue":n[5]||(n[5]=s=>e.exactAmount=s),type:"number"},null,512),[[m,e.exactAmount]])]),X,t("td",null,[p(t("input",{id:"iban","onUpdate:modelValue":n[6]||(n[6]=s=>e.iban=s),type:"text"},null,512),[[m,e.iban]])])]),t("tr",null,[t("td",Z,[t("button",{onClick:n[7]||(n[7]=(...s)=>u.filterTransactions&&u.filterTransactions(...s))},"Filter")])])])]),t("div",tt,[t("div",nt,[et,t("table",st,[ot,t("tbody",null,[(c(!0),d(v,null,S(e.transactions,(s,_)=>(c(),d("tr",{key:_},[t("td",null,r(s.transactionType),1),t("td",null,r(s==null?void 0:s.senderAccountIban),1),t("td",null,r(s==null?void 0:s.receiverAccountIban),1),t("td",null,r(u.formatDate(s.dateTime)),1),t("td",null,r(s.amount),1)]))),128))])])]),t("div",lt,[t("button",{onClick:n[8]||(n[8]=(...s)=>u.prevPage&&u.prevPage(...s)),disabled:e.currentPage===1},"Previous",8,it),t("span",null,"Page "+r(e.currentPage),1),t("button",{onClick:n[9]||(n[9]=(...s)=>u.nextPage&&u.nextPage(...s))},"Next")]),t("p",at,r(e.errorMsg),1)])])}const ut=x(C,[["render",rt]]),ct={class:"d-flex"},dt={class:"d-flex"},ht={class:"container h-25 w-10 p-3"},pt={key:0,class:"container mx-5 mt-5 mb-3 w-auto"},mt={class:"container",style:{color:"black"}},gt={style:{color:"#6504c6"}},_t={class:"table table-bordered"},yt=t("thead",null,[t("tr",null,[t("th",null,"Transaction Type"),t("th",null,"Sender"),t("th",null,"Receiver"),t("th",null,"Date"),t("th",null,"Amount (€)")])],-1),Tt={class:"pagination-controls"},ft=["disabled"],bt={key:1},vt=t("h3",{style:{color:"#6504c6"},class:"container mx-5 mt-5 mb-3 w-auto"},"You have not made any transactions yet",-1),St=[vt],At={name:"RecordPage",data(){return{userId:0,condition:"ALL",transactionStore:P(),transactions:[],currentPage:1,pageSize:10,skip:0}},methods:{formatDate:f,setUserId(o){this.$nextTick(()=>{this.userId=o,this.setCondition("ID")})},setCondition(o){this.currentPage=1,this.condition=o,o!="ID"&&(this.userId=null),this.getFilteredTransactions()},async getFilteredTransactions(){try{this.skip=(this.currentPage-1)*this.pageSize,this.limit=this.pageSize;const o=await this.transactionStore.filterTransactions(this.condition,this.userId,this.skip,this.limit);this.transactions=o,console.log(o)}catch(o){this.transactions=[],console.error(o)}},nextPage(){this.currentPage++,this.getFilteredTransactions()},prevPage(){this.currentPage>1&&(this.currentPage--,this.getFilteredTransactions())}}},Pt=Object.assign(At,{setup(o){return(n,l)=>(c(),d("div",ct,[t("div",dt,[A(w,{onSelectUser:n.setUserId},null,8,["onSelectUser"])]),t("div",ht,[t("button",{onClick:l[0]||(l[0]=i=>n.setCondition("ALL"))},"All Transactions"),t("button",{onClick:l[1]||(l[1]=i=>n.setCondition("ATM"))},"ATM transactions"),t("button",{onClick:l[2]||(l[2]=i=>n.setCondition("ADMIN"))},"Employee Transactions"),t("button",{onClick:l[3]||(l[3]=i=>n.setCondition("CUSTOMER"))},"Customer Transactions"),n.transactions.length>0?(c(),d("div",pt,[t("div",mt,[t("h1",gt,r(n.condition)+" Transactions",1),t("table",_t,[yt,t("tbody",null,[(c(!0),d(v,null,S(n.transactions,i=>(c(),d("tr",null,[t("td",null,r(i.type),1),t("td",null,r(i.sender),1),t("td",null,r(i.receiver),1),t("td",null,r(D(f)(i.dateTime)),1),t("td",null,r(i.amount),1)]))),256))])])]),t("div",Tt,[t("button",{onClick:l[4]||(l[4]=(...i)=>n.prevPage&&n.prevPage(...i)),disabled:n.currentPage===1},"Previous",8,ft),t("span",null,"Page "+r(n.currentPage),1),t("button",{onClick:l[5]||(l[5]=(...i)=>n.nextPage&&n.nextPage(...i))},"Next")])])):(c(),d("div",bt,St))])]))}}),$t={key:0},xt={data(){return{loginStore:b()}}},Ct=Object.assign(xt,{__name:"TransactionsView",setup(o){return(n,l)=>n.loginStore.hasUsertype("ADMIN")?(c(),d("div",$t,[A(Pt)])):(c(),I(ut,{key:1,type:n.$route.params.type},null,8,["type"]))}});export{Ct as default};
